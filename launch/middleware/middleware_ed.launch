<?xml version="1.0"?>

<launch>

	<param name="/use_ed" value="true"/>
   
	<arg name="env" default="$(optenv ROBOT_ENV robotics_testlab_B)" />
	<arg name="ROBOT_REAL" default="$(optenv ROBOT_REAL false)" />

    <group if="$(arg ROBOT_REAL)">
        <!-- REAL ROBOT -->

        <!-- Start all sensors -->
        <include file="$(find amigo_launch_files)/launch/sensors/sensors.launch" />
    </group>


    <!-- Localization -->
    <include file="$(find amigo_launch_files)/launch/middleware/localization.launch" />

    <!-- Navigation - local planner -->
    <node pkg="cb_base_navigation" type="cb_base_navigation_local_planner_interface" name="local_planner_interface" ns="cb_base_navigation" output="screen">
        <!-- Local Planner Settings -->
        <rosparam file="$(find amigo_parameters)/parameters/navigation/local_planner.yaml" command="load" />
        <!-- Local Costmap Settings -->
        <rosparam file="$(find amigo_parameters)/parameters/navigation/local_costmap.yaml" command="load" ns="local_costmap" />
        <!-- Topic remapping -->
        <remap from="odom" to="/amigo/base/measurements" />
        <remap from="cmd_vel" to="/amigo/base/references" />
    </node>

    <!-- Navigation - global planner -->
    <node pkg="cb_base_navigation" type="cb_base_navigation_global_planner_interface" name="global_planner_interface" ns="cb_base_navigation" output="screen">
        <!-- Global Planner Settings -->
        <rosparam file="$(find amigo_parameters)/parameters/navigation/global_planner.yaml" command="load" />
        <!-- Global Costmap Settings -->
        <rosparam file="$(find amigo_parameters)/parameters/navigation/global_costmap.yaml" command="load" ns="global_costmap" />
    </node>

    <!-- Head movement -->
	<include file="$(find head_ref)/launch/head_ref.launch" />
    <node name="head_ref_ed_client" pkg="head_ref_ed_client" type="head_ref_ed_client" output="screen" />

    <!-- Manipulation -->
    <include file="$(find amigo_launch_files)/launch/manipulation/manipulation.launch" />

    <!-- RGBD (Kinect) server -->
    <include file="$(find amigo_launch_files)/launch/sensors/top_kinect_rgbd.launch" />

    <!-- World Model -->
	<node name="ed_server" pkg="ed" type="ed_server" args="$(find ed)/config/$(optenv ED_CONFIG amigo).yaml" output="screen" />

	<!-- Reasoner -->
	<param name="/reasoner/world_model_type" value="ed"/>
    <include file="$(find tue_reasoner_core)/launch/start.launch" />

	<!-- Start text to speech -->
    <include file="$(find amigo_launch_files)/launch/interaction/text_to_speech.launch" />	

    <!-- Start speech recognition -->
    <include ns="amigo" file="$(find amigo_launch_files)/launch/interaction/df_speech_recognition.launch" />	

    <!-- Start speech interpreter -->
    <include file="$(find amigo_launch_files)/launch/interaction/speech_interpreter.launch" />	

    <!-- Action server -->
	<node name="action_server" pkg="action_server" type="action_server_main" output="screen" />
	<node name="action_server_py" pkg="action_server" type="main.py" output="screen" />

</launch>
