<?xml version="1.0"?>
<launch>

    <arg name="gui" default="true"/>
    <arg name="env" default="$(optenv ROBOT_ENV robotics_testlab_A)" />
    <arg name="robot_init_x" default="$(optenv GAZEBO_ROBOT_INIT_X 0)"/>
    <arg name="robot_init_y" default="$(optenv GAZEBO_ROBOT_INIT_Y 0)"/>
    <arg name="robot_init_phi" default="$(optenv GAZEBO_ROBOT_INIT_PHI 0)"/>
    <arg name="ROBOT_COMPLEXITY" default="$(optenv ROBOT_COMPLEXITY complex)" />
    <arg name="teleport" default="false"/>    
    <arg name="kinect_raytracing" default="true"/>

    <!-- Required simulation parameter -->
    <param name="/use_sim_time" value="true"/>

    <!-- start world file (export HEADLESS to -r if you want to run gazebo headless, this is done on the Jenkins server, ask Rob J-->
    <node name="gazebo" pkg="gazebo" type="gazebo" args="$(find amigo_maps)/worlds/$(arg env).world" respawn="false" output="screen"/>

    <!-- Spawn dynamic objects (cokecans, plants, doors etc..) -->
    <!--<include file="$(find amigo_maps)/objects/objects_$(optenv ROS_DISTRO).launch"/>-->

    <!-- start controller manager (rviz) -->
    <include file="$(find pr2_controller_manager)/controller_manager.launch"/>

    <!-- Simulation controllers -->
    <include file="$(find amigo_simulation_controllers)/controllers_$(arg ROBOT_COMPLEXITY).launch"/>

    <!-- push robot_description to factory and spawn robot in gazebo -->
    <node name="spawn_amigo" pkg="gazebo" type="spawn_model" args="-gazebo_namespace gazebo -unpause -urdf -param /amigo/robot_description -model amigo -x $(arg robot_init_x) -y $(arg robot_init_y) -Y $(arg robot_init_phi) -J spindle_joint 0.35 --skip-joint-limits" respawn="false" output="screen" />

    <!-- Launch Gazebo GUI -->
    <group if="$(arg gui)">
        <node name="gazebo_gui" pkg="gazebo" type="gui" respawn="false" output="screen"/>
    </group>

    <include file="$(find amigo_joint_interface_converter)/launch/start.launch"/>

</launch>
