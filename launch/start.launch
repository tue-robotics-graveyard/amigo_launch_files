<?xml version="1.0"?>
<launch>

    <!--
        Starts the basic functionalities of the robot:
          - Robot model
          - Sensors
          - Self filtering
          - Diagnostics
          - Text to speech
    -->

    <arg name="gui" default="true"/>

    <arg name="env" default="$(optenv ROBOT_ENV robotics_testlab_A)" />

    <arg name="ROBOT_REAL" default="$(optenv ROBOT_REAL false)" />
    <arg name="ROBOT_COMPLEXITY" default="$(optenv ROBOT_COMPLEXITY complex)" />

    <!-- Used by fast_simulator: set to true to instantly move to goals while navigating -->
    <arg name="teleport" default="false"/>    
    <arg name="kinect_raytracing" default="true"/>

    <!-- load robot -->
    <param name="/amigo/robot_description" textfile="$(find amigo_description)/urdf/amigo.urdf" />

    <!-- load robot joint group info -->
    <rosparam file="$(find amigo_description)/custom/joint_groups.yaml" command="load" />

    <!-- DIAGNOSTICS -->
    <include file="$(find amigo_launch_files)/launch/diagnostics/diagnostics.launch">
        <arg name="ROBOT_REAL" value="$(arg ROBOT_REAL)"/>
    </include>

    <group if="$(arg ROBOT_REAL)">
        <!-- REAL ROBOT -->

        <!-- robot model & integration with low level encoder data-->
        <include file="$(find amigo_state_publisher)/start.launch" />

        <!-- RGB lights manager -->
        <node name="rgb_lights_manager" pkg="rgb_lights_manager" type="rgb_lights_manager" output="screen">
            <remap from="/hardware_status" to="/amigo/hardware_status" />
            <remap from="/emergency_switch" to="/amigo/emergency_switch" />
        </node>

        <!-- Top kinect recorder -->
        <include file="$(find amigo_launch_files)/launch/recording/rec_amigo_top_kinect.launch"/>
    </group>

    <group unless="$(arg ROBOT_REAL)">
        <!-- SIMULATION -->
        <include file="$(find amigo_launch_files)/launch/simulator/$(optenv SIMULATOR).launch">
            <arg name="gui" value="$(arg gui)"/>
            <arg name="env" value="$(arg env)"/>
            <arg name="teleport" value="$(arg teleport)"/>
            <arg name="kinect_raytracing" value="$(arg kinect_raytracing)"/>
        </include>     
    </group>

    <!-- TF Server: advertises services for looking up transformations -->
    <node name="tf_server" pkg="tf_server" type="tf_server" output="screen" />

    <!-- Self filter (robots self removed from Kinect pointcloud on topic /camera/depth/points_self_filtered) -->
    <!--<include file="$(find amigo_self_filter)/start_filter.launch"/>-->

    <!-- Phone UI --> <!-- only works with groovy -->
    <include file="$(find amigo_mobile_ui)/launch/amigo.launch"/>
		
 </launch>
  
